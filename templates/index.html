{% extends "base.html" %}

{% block title %}AI Image Studio - Professional Creative Workspace{% endblock %}

{% block content %}
<div class="header">
    <h1>ğŸ¨ AI Image Studio</h1>
    <div style="font-size: 0.9rem; color: #718096; margin-top: 5px;">
        Professional AI-powered image creation and editing suite
    </div>
    <div class="time" style="margin-top: 10px;">{{ current_time }}</div>
</div>

<div class="nav-tabs">
    <button class="nav-tab active" onclick="showTab('studio-tab')">ğŸ  Studio</button>
    <button class="nav-tab" onclick="showTab('create-tab')">ğŸ¨ Create</button>
    <button class="nav-tab" onclick="showTab('edit-tab')">âœï¸ Edit</button>
    <button class="nav-tab" onclick="showTab('gallery-tab')">ğŸ“ Gallery</button>
    <button class="nav-tab" onclick="showTab('automation-tab')">ğŸ¤– Automation</button>
    <button class="nav-tab" onclick="showTab('settings-tab')">âš™ï¸ Settings</button>
</div>

<!-- Studio Overview Tab -->
<div id="studio-tab" class="tab-content active">
    <div class="system-info">
        <h3>ğŸ  Studio Overview</h3>
        <p>Welcome to your AI Image Studio - your complete creative workspace</p>
    </div>

    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin: 20px 0;">
        <!-- Quick Actions -->
        <div class="item" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white;">
            <div class="item-content">
                <h4 style="color: white; margin-bottom: 15px;">ğŸš€ Quick Actions</h4>
                <div style="display: flex; flex-direction: column; gap: 10px;">
                    {% if workflow_configured %}
                        <a href="/generator" class="btn" style="background: rgba(255,255,255,0.2); color: white; border: 1px solid rgba(255,255,255,0.3);">ğŸ¨ Create New Image</a>
                        {% if editor_configured %}
                            <a href="/editor" class="btn" style="background: rgba(255,255,255,0.2); color: white; border: 1px solid rgba(255,255,255,0.3);">âœï¸ Edit Images</a>
                        {% endif %}
                        <a href="/workflow/gallery" class="btn" style="background: rgba(255,255,255,0.2); color: white; border: 1px solid rgba(255,255,255,0.3);">ğŸ“ View Gallery</a>
                    {% else %}
                        <a href="/workflow/config" class="btn" style="background: rgba(255,255,255,0.2); color: white; border: 1px solid rgba(255,255,255,0.3);">âš™ï¸ Setup Studio</a>
                    {% endif %}
                </div>
            </div>
        </div>

        <!-- Studio Status -->
        <div class="item">
            <div class="item-content">
                <h4>ğŸ“Š Studio Status</h4>
                <div style="margin-top: 15px;">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                        <span>AI Models:</span>
                        <span style="color: {% if workflow_configured %}#48bb78{% else %}#f56565{% endif %};">
                            {% if workflow_configured %}âœ… Ready{% else %}âŒ Not Setup{% endif %}
                        </span>
                    </div>
                    <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                        <span>Image Editor:</span>
                        <span style="color: {% if editor_configured %}#48bb78{% else %}#f56565{% endif %};">
                            {% if editor_configured %}âœ… Ready{% else %}âŒ Not Setup{% endif %}
                        </span>
                    </div>
                    <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                        <span>Automation:</span>
                        <span style="color: {% if workflow_status.running %}#ed8936{% elif workflow_configured %}#48bb78{% else %}#f56565{% endif %};">
                            {% if workflow_status.running %}â³ Running{% elif workflow_configured %}âœ… Ready{% else %}âŒ Not Setup{% endif %}
                        </span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Recent Activity -->
        <div class="item">
            <div class="item-content">
                <h4>ğŸ“ˆ Recent Activity</h4>
                <div style="margin-top: 15px; color: #718096; font-size: 0.9rem;">
                    {% if workflow_status.message %}
                        <div style="margin-bottom: 10px;">
                            <strong>Last Action:</strong><br>
                            {{ workflow_status.message }}
                        </div>
                    {% endif %}
                    <div>
                        <strong>Studio Notes:</strong> {{ notes|length }} items<br>
                        <strong>Active Tasks:</strong> {{ tasks|length }} items<br>
                        <strong>Session:</strong> {{ current_time }}
                    </div>
                </div>
            </div>
        </div>
    </div>

    {% if not workflow_configured %}
        <div style="background: #fef5e7; border: 1px solid #f6e05e; border-radius: 10px; padding: 20px; margin: 20px 0;">
            <h4 style="color: #d69e2e; margin-bottom: 10px;">ğŸš€ Get Started</h4>
            <p style="color: #744210; margin-bottom: 15px;">
                Welcome to your AI Image Studio! To begin creating amazing images, you'll need to configure your AI models first.
            </p>
            <a href="/workflow/config" class="btn btn-primary">âš™ï¸ Setup Your Studio</a>
        </div>
    {% endif %}
</div>

<!-- Notes Tab (now part of studio) -->
<div id="notes-tab" class="tab-content">
    <div class="form-group">
        <label for="note-content">Add a New Note:</label>
        <form id="note-form" onsubmit="event.preventDefault(); addNote();">
            <textarea id="note-content" name="content" class="form-control" 
                      placeholder="Write your note here..." required></textarea>
            <br>
            <button type="submit" class="btn btn-primary">ğŸ’¾ Save Note</button>
        </form>
    </div>

    <div class="item-list" id="notes-list">
        {% if notes %}
            {% for note in notes %}
            <div class="item" id="note-{{ note.id }}">
                <div class="item-content">{{ note.content }}</div>
                <div class="item-meta">
                    <span>{{ note.timestamp }}</span>
                    <button class="btn btn-danger" onclick="deleteNote({{ note.id }})">ğŸ—‘ï¸ Delete</button>
                </div>
            </div>
            {% endfor %}
        {% else %}
            <div class="item">
                <div class="item-content">No notes yet. Add your first note above! ğŸ“</div>
            </div>
        {% endif %}
    </div>
</div>

<!-- Tasks Tab -->
<div id="tasks-tab" class="tab-content">
    <div class="form-group">
        <label for="task-name">Add a New Task:</label>
        <form id="task-form" onsubmit="event.preventDefault(); addTask();">
            <input type="text" id="task-name" name="task" class="form-control" 
                   placeholder="Enter task description..." required>
            <br>
            <button type="submit" class="btn btn-primary">â• Add Task</button>
        </form>
    </div>

    <div class="item-list" id="tasks-list">
        {% if tasks %}
            {% for task in tasks %}
            <div class="item task-item {% if task.completed %}completed{% endif %}" id="task-{{ task.id }}">
                <input type="checkbox" class="task-checkbox" 
                       {% if task.completed %}checked{% endif %}
                       onchange="toggleTask({{ task.id }})">
                <div style="flex: 1;">
                    <div class="item-content">{{ task.name }}</div>
                    <div class="item-meta">
                        <span>Created: {{ task.created }}</span>
                        <button class="btn btn-danger" onclick="deleteTask({{ task.id }})">ğŸ—‘ï¸ Delete</button>
                    </div>
                </div>
            </div>
            {% endfor %}
        {% else %}
            <div class="item">
                <div class="item-content">No tasks yet. Add your first task above! âœ…</div>
            </div>
        {% endif %}
    </div>
</div>

<!-- AI Image Workflow Tab -->
<div id="workflow-tab" class="tab-content">
    {% if workflow_configured %}
        <div class="system-info">
            <h3>ğŸ¨ AI Image Workflow</h3>
            <p><strong>Status:</strong> 
                {% if workflow_status.running %}
                    <span style="color: #f56565;">Running ({{ workflow_status.progress }}%)</span>
                {% else %}
                    <span style="color: #48bb78;">Ready</span>
                {% endif %}
            </p>
            {% if workflow_status.message %}
                <p><strong>Message:</strong> {{ workflow_status.message }}</p>
            {% endif %}
            {% if workflow_status.error %}
                <p style="color: #f56565;"><strong>Error:</strong> {{ workflow_status.error }}</p>
            {% endif %}
        </div>

        <div class="form-group">
            {% if not workflow_status.running %}
                <button onclick="startWorkflow()" class="btn btn-primary">ğŸš€ Generate & Analyze Images</button>
            {% else %}
                <button class="btn btn-primary" disabled>â³ Workflow Running...</button>
            {% endif %}
            <a href="/workflow/gallery" class="btn btn-primary">ğŸ–¼ï¸ View Gallery</a>
            {% if editor_configured %}
                <a href="/editor" class="btn btn-primary">âœï¸ Image Editor</a>
            {% endif %}
            <a href="/workflow/config" class="btn btn-primary">âš™ï¸ Configure</a>
        </div>

        <div id="workflow-progress" style="display: none;">
            <div style="background: #e2e8f0; border-radius: 10px; padding: 3px; margin: 20px 0;">
                <div id="progress-bar" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); height: 20px; border-radius: 8px; width: 0%; transition: width 0.3s ease;"></div>
            </div>
            <p id="progress-message">Initializing...</p>
        </div>
    {% else %}
        <div class="system-info">
            <h3>ğŸ¨ AI Image Workflow</h3>
            <p>Configure your OpenRouter API key to start generating AI images!</p>
            <br>
            <a href="/workflow/config" class="btn btn-primary">âš™ï¸ Setup Workflow</a>
        </div>
        
        <div class="system-info">
            <h3>âœ¨ Features</h3>
            <ul style="padding-left: 20px; line-height: 1.8;">
                <li><strong>AI Image Generation:</strong> Create beautiful images with Flux models</li>
                <li><strong>Smart Analysis:</strong> AI rates and categorizes your images</li>
                <li><strong>Auto-Sorting:</strong> Images sorted into Top, Mids, and Meh folders</li>
                <li><strong>Upscaling:</strong> Enhance image quality with AI upscaling</li>
                <li><strong>Gallery View:</strong> Browse and manage your generated images</li>
            </ul>
        </div>
    {% endif %}
</div>

<!-- System Tab -->
<div id="system-tab" class="tab-content">
    <div class="system-info">
        <h3>ğŸ–¥ï¸ System Information</h3>
        <p><strong>Current Time:</strong> {{ current_time }}</p>
        <p><strong>Flask App:</strong> Running successfully on Termux</p>
        <p><strong>Notes Count:</strong> {{ notes|length }}</p>
        <p><strong>Tasks Count:</strong> {{ tasks|length }}</p>
        <p><strong>AI Workflow:</strong> 
            {% if workflow_configured %}
                <span style="color: #48bb78;">Configured âœ“</span>
            {% else %}
                <span style="color: #f56565;">Not Configured</span>
            {% endif %}
        </p>
        <br>
        <a href="/system_info" class="btn btn-primary">ğŸ“Š Detailed System Info</a>
    </div>
    
    <div class="system-info">
        <h3>ğŸ“± Termux Tips</h3>
        <ul style="padding-left: 20px; line-height: 1.8;">
            <li>Keep your tablet plugged in for long sessions</li>
            <li>Use <code>Ctrl+C</code> to stop the Flask server</li>
            <li>Access from other devices using your tablet's IP address</li>
            <li>The app auto-saves all your notes and tasks</li>
            <li>AI image generation requires internet connection</li>
        </ul>
    </div>
</div>

<!-- Create Tab -->
<div id="create-tab" class="tab-content">
    <div class="system-info">
        <h3>ğŸ¨ Create Images</h3>
        <p>Generate stunning AI images with advanced controls and customization</p>
    </div>

    {% if workflow_configured %}
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin: 20px 0;">
            <div class="item">
                <div class="item-content">
                    <h4>ğŸ–¼ï¸ Single Image</h4>
                    <p style="color: #718096; margin: 10px 0;">Create one perfect image with custom settings</p>
                    <a href="/generator" class="btn btn-primary">ğŸ¨ Open Generator</a>
                </div>
            </div>

            <div class="item">
                <div class="item-content">
                    <h4>ğŸ“š Batch Generation</h4>
                    <p style="color: #718096; margin: 10px 0;">Generate multiple variations automatically</p>
                    <a href="/generator" class="btn btn-primary">ğŸ“š Batch Create</a>
                </div>
            </div>

            <div class="item">
                <div class="item-content">
                    <h4>âš™ï¸ Advanced Mode</h4>
                    <p style="color: #718096; margin: 10px 0;">Fine-tune every parameter for expert control</p>
                    <a href="/generator" class="btn btn-primary">âš™ï¸ Advanced</a>
                </div>
            </div>
        </div>

        <div class="system-info">
            <h4>ğŸ¯ Quick Start Templates</h4>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-top: 15px;">
                <button class="btn" style="background: #e2e8f0; color: #4a5568; text-align: left; padding: 15px;" onclick="useTemplate('portrait')">
                    ğŸ‘¤ Portrait<br><small>Professional headshots and portraits</small>
                </button>
                <button class="btn" style="background: #e2e8f0; color: #4a5568; text-align: left; padding: 15px;" onclick="useTemplate('landscape')">
                    ğŸï¸ Landscape<br><small>Beautiful scenery and nature</small>
                </button>
                <button class="btn" style="background: #e2e8f0; color: #4a5568; text-align: left; padding: 15px;" onclick="useTemplate('abstract')">
                    ğŸ¨ Abstract<br><small>Creative and artistic designs</small>
                </button>
                <button class="btn" style="background: #e2e8f0; color: #4a5568; text-align: left; padding: 15px;" onclick="useTemplate('product')">
                    ğŸ“¦ Product<br><small>Commercial and product shots</small>
                </button>
            </div>
        </div>
    {% else %}
        <div style="background: #fef5e7; border: 1px solid #f6e05e; border-radius: 10px; padding: 20px; text-align: center;">
            <h4 style="color: #d69e2e;">âš™ï¸ Setup Required</h4>
            <p style="color: #744210;">Configure your AI models to start creating images</p>
            <a href="/workflow/config" class="btn btn-primary">Setup Studio</a>
        </div>
    {% endif %}
</div>

<!-- Edit Tab -->
<div id="edit-tab" class="tab-content">
    <div class="system-info">
        <h3>âœï¸ Edit Images</h3>
        <p>Enhance, modify, and perfect your images with AI-powered editing tools</p>
    </div>

    {% if editor_configured %}
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin: 20px 0;">
            <div class="item">
                <div class="item-content">
                    <h4>ğŸ–Œï¸ Inpainting</h4>
                    <p style="color: #718096; margin: 10px 0;">Remove or replace parts of your images</p>
                    <a href="/editor" class="btn btn-primary">ğŸ–Œï¸ Open Editor</a>
                </div>
            </div>

            <div class="item">
                <div class="item-content">
                    <h4>ğŸ”„ Transform</h4>
                    <p style="color: #718096; margin: 10px 0;">Change style, mood, or appearance</p>
                    <a href="/editor" class="btn btn-primary">ğŸ”„ Transform</a>
                </div>
            </div>

            <div class="item">
                <div class="item-content">
                    <h4>ğŸ­ Background</h4>
                    <p style="color: #718096; margin: 10px 0;">Remove or replace backgrounds</p>
                    <a href="/editor" class="btn btn-primary">ğŸ­ Edit BG</a>
                </div>
            </div>
        </div>
    {% else %}
        <div style="background: #fef5e7; border: 1px solid #f6e05e; border-radius: 10px; padding: 20px; text-align: center;">
            <h4 style="color: #d69e2e;">âš™ï¸ Setup Required</h4>
            <p style="color: #744210;">Configure your AI models to start editing images</p>
            <a href="/workflow/config" class="btn btn-primary">Setup Studio</a>
        </div>
    {% endif %}
</div>

<!-- Gallery Tab -->
<div id="gallery-tab" class="tab-content">
    <div class="system-info">
        <h3>ğŸ“ Gallery</h3>
        <p>Organize and manage your created images and projects</p>
    </div>

    {% if workflow_configured %}
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin: 20px 0;">
            <div class="item">
                <div class="item-content">
                    <h4>ğŸ–¼ï¸ Generated Images</h4>
                    <p style="color: #718096; margin: 10px 0;">View all your AI-generated creations</p>
                    <a href="/workflow/gallery" class="btn btn-primary">ğŸ“ View Gallery</a>
                </div>
            </div>

            <div class="item">
                <div class="item-content">
                    <h4>âœï¸ Edited Images</h4>
                    <p style="color: #718096; margin: 10px 0;">Browse your edited and enhanced images</p>
                    <a href="/editor/gallery" class="btn btn-primary">âœï¸ Edit Gallery</a>
                </div>
            </div>

            <div class="item">
                <div class="item-content">
                    <h4>â­ Favorites</h4>
                    <p style="color: #718096; margin: 10px 0;">Your starred and favorite images</p>
                    <button class="btn btn-primary" onclick="showFavorites()">â­ Favorites</button>
                </div>
            </div>
        </div>
    {% else %}
        <div style="background: #fef5e7; border: 1px solid #f6e05e; border-radius: 10px; padding: 20px; text-align: center;">
            <h4 style="color: #d69e2e;">ğŸ“ No Images Yet</h4>
            <p style="color: #744210;">Create your first images to see them here</p>
            <a href="/workflow/config" class="btn btn-primary">Setup Studio</a>
        </div>
    {% endif %}
</div>

<!-- Automation Tab -->
<div id="automation-tab" class="tab-content">
    <div class="system-info">
        <h3>ğŸ¤– Automation</h3>
        <p>Smart workflows and batch processing for efficient image creation</p>
    </div>

    {% if workflow_configured %}
        <div class="system-info">
            <h4>ğŸ“Š Workflow Status</h4>
            <p><strong>Status:</strong> 
                {% if workflow_status.running %}
                    <span style="color: #f56565;">Running ({{ workflow_status.progress }}%)</span>
                {% else %}
                    <span style="color: #48bb78;">Ready</span>
                {% endif %}
            </p>
            {% if workflow_status.message %}
                <p><strong>Message:</strong> {{ workflow_status.message }}</p>
            {% endif %}
            {% if workflow_status.error %}
                <p style="color: #f56565;"><strong>Error:</strong> {{ workflow_status.error }}</p>
            {% endif %}
        </div>

        <div class="form-group">
            {% if not workflow_status.running %}
                <button onclick="startWorkflow()" class="btn btn-primary">ğŸš€ Start Automated Workflow</button>
            {% else %}
                <button class="btn btn-primary" disabled>â³ Workflow Running...</button>
            {% endif %}
            <a href="/workflow/gallery" class="btn" style="background: #e2e8f0; color: #4a5568; margin-left: 10px;">ğŸ“ View Results</a>
        </div>

        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin: 20px 0;">
            <div class="item">
                <div class="item-content">
                    <h4>âš¡ Quick Batch</h4>
                    <p style="color: #718096; margin: 10px 0;">Generate multiple variations of a prompt</p>
                    <button onclick="quickBatch()" class="btn btn-primary">âš¡ Quick Batch</button>
                </div>
            </div>

            <div class="item">
                <div class="item-content">
                    <h4>ğŸ¯ Smart Analysis</h4>
                    <p style="color: #718096; margin: 10px 0;">AI-powered quality rating and sorting</p>
                    <button onclick="analyzeImages()" class="btn btn-primary">ğŸ¯ Analyze</button>
                </div>
            </div>

            <div class="item">
                <div class="item-content">
                    <h4>ğŸ“‹ Custom Workflow</h4>
                    <p style="color: #718096; margin: 10px 0;">Create your own automation sequences</p>
                    <button onclick="customWorkflow()" class="btn btn-primary">ğŸ“‹ Custom</button>
                </div>
            </div>
        </div>
    {% else %}
        <div style="background: #fef5e7; border: 1px solid #f6e05e; border-radius: 10px; padding: 20px; text-align: center;">
            <h4 style="color: #d69e2e;">âš™ï¸ Setup Required</h4>
            <p style="color: #744210;">Configure your AI models to use automation features</p>
            <a href="/workflow/config" class="btn btn-primary">Setup Studio</a>
        </div>
    {% endif %}
</div>

<!-- Settings Tab -->
<div id="settings-tab" class="tab-content">
    <div class="system-info">
        <h3>âš™ï¸ Studio Settings</h3>
        <p>Configure your AI models, safety settings, and studio preferences</p>
    </div>

    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin: 20px 0;">
        <div class="item">
            <div class="item-content">
                <h4>ğŸ¤– AI Models</h4>
                <p style="color: #718096; margin: 10px 0;">Configure generation and vision models</p>
                <a href="/workflow/config" class="btn btn-primary">ğŸ¤– AI Setup</a>
            </div>
        </div>

        <div class="item">
            <div class="item-content">
                <h4>ğŸ›¡ï¸ Safety Settings</h4>
                <p style="color: #718096; margin: 10px 0;">Content filtering and moderation controls</p>
                <a href="/workflow/config" class="btn btn-primary">ğŸ›¡ï¸ Safety</a>
            </div>
        </div>

        <div class="item">
            <div class="item-content">
                <h4>ğŸ“Š System Info</h4>
                <p style="color: #718096; margin: 10px 0;">View system status and performance</p>
                <a href="/system_info" class="btn btn-primary">ğŸ“Š System</a>
            </div>
        </div>
    </div>

    <div class="system-info">
        <h4>ğŸ“± Studio Tips</h4>
        <ul style="padding-left: 20px; line-height: 1.8;">
            <li><strong>Performance:</strong> Keep your tablet plugged in for long sessions</li>
            <li><strong>Navigation:</strong> Use the studio tabs to access different tools</li>
            <li><strong>Safety:</strong> Configure content filtering for your use case</li>
            <li><strong>Quality:</strong> Use Pro models for best results (higher cost)</li>
            <li><strong>Automation:</strong> Let AI analyze and sort your images automatically</li>
        </ul>
    </div>
</div>

<div class="footer">
    <p>ğŸ¨ AI Image Studio | Professional creative workspace for your tablet</p>
</div>

<script>
    function addNote() {
        submitForm('note-form', '/add_note', function(data) {
            location.reload();
        });
    }

    function addTask() {
        submitForm('task-form', '/add_task', function(data) {
            location.reload();
        });
    }

    function deleteNote(noteId) {
        deleteItem(`/delete_note/${noteId}`, function(data) {
            location.reload();
        });
    }

    function deleteTask(taskId) {
        deleteItem(`/delete_task/${taskId}`, function(data) {
            location.reload();
        });
    }

    // Workflow functions
    function startWorkflow() {
        fetch('/workflow/start', {
            method: 'POST'
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                document.getElementById('workflow-progress').style.display = 'block';
                pollWorkflowStatus();
            } else {
                alert('Error: ' + data.error);
            }
        })
        .catch(error => {
            console.error('Error:', error);
            alert('Failed to start workflow');
        });
    }

    function pollWorkflowStatus() {
        const interval = setInterval(function() {
            fetch('/workflow/status')
            .then(response => response.json())
            .then(data => {
                const progressBar = document.getElementById('progress-bar');
                const progressMessage = document.getElementById('progress-message');
                
                if (progressBar) {
                    progressBar.style.width = data.progress + '%';
                }
                
                if (progressMessage) {
                    progressMessage.textContent = data.message || 'Processing...';
                }
                
                if (!data.running) {
                    clearInterval(interval);
                    if (data.error) {
                        alert('Workflow failed: ' + data.error);
                    } else {
                        alert('Workflow completed successfully! Check the gallery to view your images.');
                    }
                    setTimeout(() => location.reload(), 1000);
                }
            })
            .catch(error => {
                console.error('Error polling status:', error);
                clearInterval(interval);
            });
        }, 2000); // Poll every 2 seconds
    }

    // Auto-refresh time every minute (but not during workflow)
    setInterval(function() {
        fetch('/workflow/status')
        .then(response => response.json())
        .then(data => {
            if (!data.running) {
                location.reload();
            }
        })
        .catch(() => location.reload());
    }, 60000);

    // Studio template functions
    function useTemplate(type) {
        const templates = {
            'portrait': 'Professional portrait, high quality, studio lighting, detailed face, photorealistic',
            'landscape': 'Beautiful landscape, scenic view, natural lighting, high resolution, artistic composition',
            'abstract': 'Abstract art, creative design, vibrant colors, artistic style, modern composition',
            'product': 'Product photography, clean background, professional lighting, commercial style, high quality'
        };
        
        const prompt = templates[type];
        if (prompt) {
            // Store template and redirect to generator
            localStorage.setItem('templatePrompt', prompt);
            window.location.href = '/generator';
        }
    }

    // Studio automation functions
    function quickBatch() {
        const prompt = prompt('Enter a prompt for quick batch generation:');
        if (prompt) {
            // Redirect to generator with batch mode
            localStorage.setItem('batchPrompt', prompt);
            window.location.href = '/generator';
        }
    }

    function analyzeImages() {
        if (confirm('Analyze all images in your gallery for quality rating?')) {
            fetch('/workflow/analyze_all', { method: 'POST' })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    alert('Analysis started! Check the automation tab for progress.');
                } else {
                    alert('Analysis failed: ' + data.error);
                }
            });
        }
    }

    function customWorkflow() {
        alert('Custom workflow builder coming soon! For now, use the automation tab to start predefined workflows.');
    }

    function showFavorites() {
        alert('Favorites feature coming soon! For now, use the gallery to browse all your images.');
    }
</script>
{% endblock %}